import * as tslib_1 from "tslib";
import { CalendarDateFormatter } from 'angular-calendar';
import { DAYS_IN_WEEK } from '../utils/calendar-scheduler-utils';
var SchedulerDateFormatter = /** @class */ (function (_super) {
    tslib_1.__extends(SchedulerDateFormatter, _super);
    function SchedulerDateFormatter() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * The time formatting down the left hand side of the day view
     */
    SchedulerDateFormatter.prototype.dayViewHour = function (_a) {
        var date = _a.date, locale = _a.locale;
        return new Intl.DateTimeFormat(locale, { hour: 'numeric', minute: 'numeric' }).format(date);
    };
    SchedulerDateFormatter.prototype.weekViewTitle = function (_a) {
        var dateAdapter = _a.dateAdapter, date = _a.date, locale = _a.locale, weekStartsOn = _a.weekStartsOn, excludeDays = _a.excludeDays, daysInWeek = _a.daysInWeek, startsWithToday = _a.startsWithToday;
        // http://generatedcontent.org/post/59403168016/esintlapi
        var year = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(date);
        var month = new Intl.DateTimeFormat(locale, { month: 'short' }).format(date);
        var dateInner = startsWithToday || daysInWeek < DAYS_IN_WEEK
            ? date
            : dateAdapter.startOfWeek(date, { weekStartsOn: weekStartsOn });
        // var firstDay: number = date.getDate() - date.getDay() + 1; // First day is the day of the month - the day of the week
        var firstDay = dateInner.getDate();
        while (excludeDays.includes(firstDay)) {
            firstDay += 1;
        }
        var lastDay = firstDay + (daysInWeek - 1); // last day is the first day + (daysInWeek - 1)
        while (excludeDays.includes(lastDay)) {
            lastDay += 1;
        }
        var firstDayMonth = month;
        var lastDayMonth = month;
        var firstDayYear = year;
        var lastDayYear = year;
        if (firstDay < 1) {
            var prevMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() - 1);
            firstDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(prevMonthDate);
            var daysInPrevMonth = this.daysInMonth(prevMonthDate);
            var i = 0;
            var prevMonthDay = daysInPrevMonth;
            for (i = 0; i < Math.abs(firstDay); i++) {
                prevMonthDay--;
            }
            firstDay = prevMonthDay;
            var prevMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(prevMonthDate);
            if (Number(prevMonthYear) < Number(year)) {
                firstDayYear = prevMonthYear;
            }
        }
        var daysInMonth = this.daysInMonth(dateInner);
        if (lastDay > daysInMonth) {
            var nextMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() + 1);
            lastDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(nextMonthDate);
            var i = 0;
            var nextMonthDay = 0;
            for (i = 0; i < (lastDay - daysInMonth); i++) {
                nextMonthDay++;
            }
            lastDay = nextMonthDay;
            var nextMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(nextMonthDate);
            if (Number(nextMonthYear) > Number(year)) {
                lastDayYear = nextMonthYear;
            }
        }
        return "" + firstDay + (firstDayMonth !== lastDayMonth || lastDay === firstDay ? ' ' + firstDayMonth : '') +
            (firstDayYear !== lastDayYear ? ' ' + firstDayYear : '') +
            (lastDay === firstDay ? '' : " - " + lastDay + " " + lastDayMonth + " " + lastDayYear);
    };
    SchedulerDateFormatter.prototype.daysInMonth = function (anyDateInMonth) {
        return new Date(anyDateInMonth.getFullYear(), anyDateInMonth.getMonth() + 1, 0).getDate();
    };
    return SchedulerDateFormatter;
}(CalendarDateFormatter));
export { SchedulerDateFormatter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGVyLWRhdGUtZm9ybWF0dGVyLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1jYWxlbmRhci1zY2hlZHVsZXIvIiwic291cmNlcyI6WyJtb2R1bGVzL3NjaGVkdWxlci9mb3JtYXR0ZXJzL3NjaGVkdWxlci1kYXRlLWZvcm1hdHRlci5wcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLHFCQUFxQixFQUFvQyxNQUFNLGtCQUFrQixDQUFDO0FBQzNGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQU9qRTtJQUE0QyxrREFBcUI7SUFBakU7O0lBK0VBLENBQUM7SUE3RUc7O09BRUc7SUFDSSw0Q0FBVyxHQUFsQixVQUFtQixFQUE4QztZQUE1QyxjQUFJLEVBQUUsa0JBQU07UUFDN0IsT0FBTyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEcsQ0FBQztJQUVNLDhDQUFhLEdBQXBCLFVBQXFCLEVBQW1IO1lBQWpILDRCQUFXLEVBQUUsY0FBSSxFQUFFLGtCQUFNLEVBQUUsOEJBQVksRUFBRSw0QkFBVyxFQUFFLDBCQUFVLEVBQUUsb0NBQWU7UUFDcEcseURBQXlEO1FBQ3pELElBQU0sSUFBSSxHQUFXLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkYsSUFBTSxLQUFLLEdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV2RixJQUFNLFNB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QWMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDekcsSUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUN0QyxXQUFXLEdBQUcsYUFBYSxDQUFDO2FBQy9CO1NBQ0o7UUFFRCxPQUFPLEtBQUcsUUFBVSxHQUFHLENBQUMsYUFBYSxLQUFLLFlBQVksSUFBSSxPQUFPLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdEcsQ0FBQyxZQUFZLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDeEQsQ0FBQyxPQUFPLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQU0sT0FBTyxTQUFJLFlBQVksU0FBSSxXQUFhLENBQUMsQ0FBQztJQUNyRixDQUFDO0lBRU8sNENBQVcsR0FBbkIsVUFBb0IsY0FBb0I7UUFDcEMsT0FBTyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLEVBQUUsY0FBYyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUM5RixDQUFDO0lBQ0wsNkJBQUM7QUFBRCxDQUFDLEFBL0VELENBQTRDLHFCQUFxQixHQStFaEUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYWxlbmRhckRhdGVGb3JtYXR0ZXIsIERhdGVGb3JtYXR0ZXJQYXJhbXMsIERhdGVBZGFwdGVyIH0gZnJvbSAnYW5ndWxhci1jYWxlbmRhcic7XHJcbmltcG9ydCB7IERBWVNfSU5fV0VFSyB9IGZyb20gJy4uL3V0aWxzL2NhbGVuZGFyLXNjaGVkdWxlci11dGlscyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNjaGVkdWxlckRhdGVGb3JtYXR0ZXJQYXJhbXMgZXh0ZW5kcyBEYXRlRm9ybWF0dGVyUGFyYW1zIHtcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcjtcclxuICAgIHN0YXJ0c1dpdGhUb2RheTogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFNjaGVkdWxlckRhdGVGb3JtYXR0ZXIgZXh0ZW5kcyBDYWxlbmRhckRhdGVGb3JtYXR0ZXIge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHRpbWUgZm9ybWF0dGluZyBkb3duIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUgZGF5IHZpZXdcclxuICAgICAqL1xyXG4gICAgcHVibGljIGRheVZpZXdIb3VyKHsgZGF0ZSwgbG9jYWxlIH06IFNjaGVkdWxlckRhdGVGb3JtYXR0ZXJQYXJhbXMpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgaG91cjogJ251bWVyaWMnLCBtaW51dGU6ICdudW1lcmljJyB9KS5mb3JtYXQoZGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHdlZWtWaWV3VGl0bGUoeyBkYXRlQWRhcHRlciwgZGF0ZSwgbG9jYWxlLCB3ZWVrU3RhcnRzT24sIGV4Y2x1ZGVEYXlzLCBkYXlzSW5XZWVrLCBzdGFydHNXaXRoVG9kYXkgfTogU2NoZWR1bGVyRGF0ZUZvcm1hdHRlclBhcmFtcyk6IHN0cmluZyB7XHJcbiAgICAgICAgLy8gaHR0cDovL2dlbmVyYXRlZGNvbnRlbnQub3JnL3Bvc3QvNTk0MDMxNjgwMTYvZXNpbnRsYXBpXHJcbiAgICAgICAgY29uc3QgeWVhcjogc3RyaW5nID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IHllYXI6ICdudW1lcmljJyB9KS5mb3JtYXQoZGF0ZSk7XHJcbiAgICAgICAgY29uc3QgbW9udGg6IHN0cmluZyA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyBtb250aDogJ3Nob3J0JyB9KS5mb3JtYXQoZGF0ZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGVJbm5lcjogRGF0ZSA9IHN0YXJ0c1dpdGhUb2RheSB8fCBkYXlzSW5XZWVrIDwgREFZU19JTl9XRUVLXHJcbiAgICAgICAgICAgID8gZGF0ZVxyXG4gICAgICAgICAgICA6IGRhdGVBZGFwdGVyLnN0YXJ0T2ZXZWVrKGRhdGUsIHsgd2Vla1N0YXJ0c09uOiB3ZWVrU3RhcnRzT24gfSk7XHJcblxyXG4gICAgICAgIC8vIHZhciBmaXJzdERheTogbnVtYmVyID0gZGF0ZS5nZXREYXRlKCkgLSBkYXRlLmdldERheSgpICsgMTsgLy8gRmlyc3QgZGF5IGlzIHRoZSBkYXkgb2YgdGhlIG1vbnRoIC0gdGhlIGRheSBvZiB0aGUgd2Vla1xyXG4gICAgICAgIGxldCBmaXJzdERheTogbnVtYmVyID0gZGF0ZUlubmVyLmdldERhdGUoKTtcclxuICAgICAgICB3aGlsZSAoZXhjbHVkZURheXMuaW5jbHVkZXMoZmlyc3REYXkpKSB7XHJcbiAgICAgICAgICAgIGZpcnN0RGF5ICs9IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbGFzdERheTogbnVtYmVyID0gZmlyc3REYXkgKyAoZGF5c0luV2VlayAtIDEpOyAvLyBsYXN0IGRheSBpcyB0aGUgZmlyc3QgZGF5ICsgKGRheXNJbldlZWsgLSAxKVxyXG4gICAgICAgIHdoaWxlIChleGNsdWRlRGF5cy5pbmNsdWRlcyhsYXN0RGF5KSkge1xyXG4gICAgICAgICAgICBsYXN0RGF5ICs9IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZmlyc3REYXlNb250aDogc3RyaW5nID0gbW9udGg7XHJcbiAgICAgICAgbGV0IGxhc3REYXlNb250aDogc3RyaW5nID0gbW9udGg7XHJcblxyXG4gICAgICAgIGxldCBmaXJzdERheVllYXI6IHN0cmluZyA9IHllYXI7XHJcbiAgICAgICAgbGV0IGxhc3REYXlZZWFyOiBzdHJpbmcgPSB5ZWFyO1xyXG5cclxuICAgICAgICBpZiAoZmlyc3REYXkgPCAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZNb250aERhdGU6IERhdGUgPSBuZXcgRGF0ZShkYXRlSW5uZXIuZ2V0RnVsbFllYXIoKSwgZGF0ZUlubmVyLmdldE1vbnRoKCkgLSAxKTtcclxuICAgICAgICAgICAgZmlyc3REYXlNb250aCA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyBtb250aDogJ3Nob3J0JyB9KS5mb3JtYXQocHJldk1vbnRoRGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRheXNJblByZXZNb250aDogbnVtYmVyID0gdGhpcy5kYXlzSW5Nb250aChwcmV2TW9udGhEYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpOiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBsZXQgcHJldk1vbnRoRGF5OiBudW1iZXIgPSBkYXlzSW5QcmV2TW9udGg7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBNYXRoLmFicyhmaXJzdERheSk7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgcHJldk1vbnRoRGF5LS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmlyc3REYXkgPSBwcmV2TW9udGhEYXk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2TW9udGhZZWFyOiBzdHJpbmcgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgeWVhcjogJ251bWVyaWMnIH0pLmZvcm1hdChwcmV2TW9udGhEYXRlKTtcclxuICAgICAgICAgICAgaWYgKE51bWJlcihwcmV2TW9udGhZZWFyKSA8IE51bWJlcih5ZWFyKSkge1xyXG4gICAgICAgICAgICAgICAgZmlyc3REYXlZZWFyID0gcHJldk1vbnRoWWVhcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF5c0luTW9udGg6IG51bWJlciA9IHRoaXMuZGF5c0luTW9udGgoZGF0ZUlubmVyKTtcclxuICAgICAgICBpZiAobGFzdERheSA+IGRheXNJbk1vbnRoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRNb250aERhdGU6IERhdGUgPSBuZXcgRGF0ZShkYXRlSW5uZXIuZ2V0RnVsbFllYXIoKSwgZGF0ZUlubmVyLmdldE1vbnRoKCkgKyAxKTtcclxuICAgICAgICAgICAgbGFzdERheU1vbnRoID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChuZXh0TW9udGhEYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpOiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBsZXQgbmV4dE1vbnRoRGF5OiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgKGxhc3REYXkgLSBkYXlzSW5Nb250aCk7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbmV4dE1vbnRoRGF5Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGFzdERheSA9IG5leHRNb250aERheTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRNb250aFllYXI6IHN0cmluZyA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyB5ZWFyOiAnbnVtZXJpYycgfSkuZm9ybWF0KG5leHRNb250aERhdGUpO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyKG5leHRNb250aFllYXIpID4gTnVtYmVyKHllYXIpKSB7XHJcbiAgICAgICAgICAgICAgICBsYXN0RGF5WWVhciA9IG5leHRNb250aFllYXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBgJHtmaXJzdERheX1gICsgKGZpcnN0RGF5TW9udGggIT09IGxhc3REYXlNb250aCB8fCBsYXN0RGF5ID09PSBmaXJzdERheSA/ICcgJyArIGZpcnN0RGF5TW9udGggOiAnJykgK1xyXG4gICAgICAgICAgICAoZmlyc3REYXlZZWFyICE9PSBsYXN0RGF5WWVhciA/ICcgJyArIGZpcnN0RGF5WWVhciA6ICcnKSArXHJcbiAgICAgICAgICAgIChsYXN0RGF5ID09PSBmaXJzdERheSA/ICcnIDogYCAtICR7bGFzdERheX0gJHtsYXN0RGF5TW9udGh9ICR7bGFzdERheVllYXJ9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkYXlzSW5Nb250aChhbnlEYXRlSW5Nb250aDogRGF0ZSk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGFueURhdGVJbk1vbnRoLmdldEZ1bGxZZWFyKCksIGFueURhdGVJbk1vbnRoLmdldE1vbnRoKCkgKyAxLCAwKS5nZXREYXRlKCk7XHJcbiAgICB9XHJcbn1cclxuIl19